var QQMapWX = function (a) { if (!a.key) throw Error("key值不能为空"); this.key = a.key }; QQMapWX.prototype.search = function (a) { var b = this; a = a || {}; var c = { keyword: a.keyword || "", orderby: a.orderby || "_distance", page_size: a.page_size || 10, page_index: a.page_index || 1, output: "json", key: b.key }, d = a.location; d && (c.boundary = "nearby(" + d.latitude + "," + d.longitude + "," + 1E3 + ")"); wx.request({ url: "https://apis.map.qq.com/ws/place/v1/search", data: c, header: { "content-type": "application/json" }, method: "GET", success: function (b) { if (0 == b.data.status) { var c = b.data.data; for (var d = 0; d < c.length; d++)c[d]._distance = b.data.data[d]._distance; a.success && a.success(b.data) } else a.fail && a.fail(b.data) }, fail: function (b) { a.fail && a.fail(b) }, complete: function (b) { a.complete && a.complete(b) } }) }, QQMapWX.prototype.getSuggestion = function (a) { var b = this; a = a || {}; var c = { keyword: a.keyword || "", region: a.region || "全国", region_fix: a.region_fix || 0, policy: a.policy || 0, page_size: a.page_size || 10, page_index: a.page_index || 1, get_subpois: a.get_subpois || 0, output: "json", key: b.key }; wx.request({ url: "https://apis.map.qq.com/ws/place/v1/suggestion", data: c, header: { "content-type": "application/json" }, method: "GET", success: function (b) { 0 == b.data.status ? a.success && a.success(b.data) : a.fail && a.fail(b.data) }, fail: function (b) { a.fail && a.fail(b) }, complete: function (b) { a.complete && a.complete(b) } }) }, QQMapWX.prototype.reverseGeocoder = function (a) { var b = this; a = a || {}; var c = { coord_type: a.coord_type || 5, get_poi: a.get_poi || 0, output: "json", key: b.key }; a.location && (c.location = a.location.latitude + "," + a.location.longitude); wx.request({ url: "https://apis.map.qq.com/ws/geocoder/v1/", data: c, header: { "content-type": "application/json" }, method: "GET", success: function (b) { 0 == b.data.status ? a.success && a.success(b.data) : a.fail && a.fail(b.data) }, fail: function (b) { a.fail && a.fail(b) }, complete: function (b) { a.complete && a.complete(b) } }) }, QQMapWX.prototype.geocoder = function (a) { var b = this; a = a || {}; var c = { address: a.address || "", output: "json", key: b.key }; wx.request({ url: "https://apis.map.qq.com/ws/geocoder/v1/", data: c, header: { "content-type": "application/json" }, method: "GET", success: function (b) { 0 == b.data.status ? a.success && a.success(b.data) : a.fail && a.fail(b.data) }, fail: function (b) { a.fail && a.fail(b) }, complete: function (b) { a.complete && a.complete(b) } }) }, QQMapWX.prototype.getCityList = function (a) { var b = this; a = a || {}; var c = { output: "json", key: b.key }; wx.request({ url: "https://apis.map.qq.com/ws/district/v1/list", data: c, header: { "content-type": "application/json" }, method: "GET", success: function (b) { 0 == b.data.status ? a.success && a.success(b.data) : a.fail && a.fail(b.data) }, fail: function (b) { a.fail && a.fail(b) }, complete: function (b) { a.complete && a.complete(b) } }) }, QQMapWX.prototype.getDistrictByCityId = function (a) { var b = this; a = a || {}; var c = { id: a.id || "", output: "json", key: b.key }; wx.request({ url: "https://apis.map.qq.com/ws/district/v1/getchildren", data: c, header: { "content-type": "application/json" }, method: "GET", success: function (b) { 0 == b.data.status ? a.success && a.success(b.data) : a.fail && a.fail(b.data) }, fail: function (b) { a.fail && a.fail(b) }, complete: function (b) { a.complete && a.complete(b) } }) }, QQMapWX.prototype.calculateDistance = function (a) { var b = this; a = a || {}; var c = { mode: a.mode || "walking", to: function (a) { var b = ""; for (var c = 0; c < a.length; c++)b += a[c].latitude + "," + a[c].longitude + ";"; return b.substring(0, b.length - 1) }(a.to), output: "json", key: b.key }; a.from && (c.from = a.from.latitude + "," + a.from.longitude); wx.request({ url: "https://apis.map.qq.com/ws/distance/v1/", data: c, header: { "content-type": "application/json" }, method: "GET", success: function (b) { 0 == b.data.status ? a.success && a.success(b.data) : a.fail && a.fail(b.data) }, fail: function (b) { a.fail && a.fail(b) }, complete: function (b) { a.complete && a.complete(b) } }) }; module.exports = QQMapWX;
